<div class="settings-page-container">
  <h1>Opperating Settings</h1>
  <form *ngIf="!loading" class="settings-form" [formGroup]="timeSpanForm">
    <div class="row-container">

      <mat-form-field style="width:250px;">
        <mat-label>Gap Between</mat-label>
        <input matInput type="number" (keypress)="numericOnly($event)" formControlName="gapBetweenAppointments">
        <mat-hint>Number of hours between appointments</mat-hint>
        <mat-error *ngIf="timeSpanForm.get('gapBetweenAppointments')?.hasError('required')">Gap Between is
          required.</mat-error>
        <mat-error *ngIf="timeSpanForm.get('gapBetweenAppointments')?.hasError('min')">Gap Between should be a positive
          number.</mat-error>
      </mat-form-field>

      <mat-form-field style="width:250px;">
        <mat-label>Months Ahead</mat-label>
        <input matInput type="number" (keypress)="numericOnly($event)" formControlName="bookMonthsAheadLimit">
        <mat-hint>Number of months in advance the customer can book</mat-hint>
        <mat-error *ngIf="timeSpanForm.get('bookMonthsAheadLimit')?.hasError('required')">Months Ahead is
          required.</mat-error>
        <mat-error *ngIf="timeSpanForm.get('bookMonthsAheadLimit')?.hasError('min')">Months Ahead should be a positive
          number.</mat-error>
      </mat-form-field>
    </div>
  </form>
  <form *ngIf="!loading" class="settings-form" [formGroup]="openingHoursForm">
    <div class="opening-hours-container" formArrayName="openingTimes">
      <div class="day-card" *ngFor="let dayControl of openingTimes.controls; let i = index" [formGroupName]="i">

        <mat-checkbox style="margin-right:10px" formControlName="checked">{{dayControl.value.dayName}}</mat-checkbox>

        <mat-form-field style="margin-bottom: 20px; width: 120px;">
          <mat-label>From</mat-label>
          <mat-select formControlName="from">
            <mat-option *ngFor="let option of timeOptions" [value]="option">
              {{option.label}}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field style="margin-bottom: 20px; width: 120px;">
          <mat-label>To</mat-label>
          <mat-select formControlName="to">
            <mat-option *ngFor="let option of timeOptions" [value]="option">
              {{option.label}}
            </mat-option>
          </mat-select>
          <mat-hint *ngIf="dayControl.hasError('timeInvalid')" style="color:red;">*Invalid Time</mat-hint>
        </mat-form-field>
      </div>
    </div>
    <mat-card class="error-container" [ngClass]="{'visible': errorMessage, 'invisible': !errorMessage}"
      style="background-color:red; color: white; margin-bottom:10px; margin-left: auto;margin-right: auto; width: 200px; ">
      <mat-card-content>{{errorMessage}}</mat-card-content>
    </mat-card>
    <button mat-raised-button color="primary" style="margin-left: auto;margin-right: auto; width: 200px;"
      (click)="saveSettings($event)">Save</button>
  </form>
  <ng-container *ngIf="loading" class="loading-settings-container">
    <mat-spinner [diameter]="50" [strokeWidth]="5"></mat-spinner>
  </ng-container>
</div>